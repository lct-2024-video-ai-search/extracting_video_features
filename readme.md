# ML сервис извлечения признаков из видео

Можно поднять докер контейнером, будет поднят микросервис на FastAPI с ручкой (вся логика в `main.py`):
- `/api/get_descriptions`

Сервису приходит `POST` запрос с телом:
```json
{
  "video_url": "string",
  "video_desc": "string"
}
```
Где:
- `video_url` – ссылка на видео из объектного хранилища (например S3, minio)
- `video_desc` – описание видео (хэштеги в том числе)

Ответ сервиса:
```json
{
  "video_url": "string",
  "video_desc": "string",
  "video_movement_desc": "string",
  "speech_desc": "string"
}
```
Где:
- `video_url` –  ссылка на видео из объектного хранилища
- `video_desc` – описание видео (хэштеги в том числе)
- `video_movement_desc` - описание происходящего на видео
- `speech_desc` – описание аудио из видео (транскрипция)

Флоу:
1. Скачивается видео и временно хранится в памяти функцией `download_video()` из `download_video.py`.
2. Запускается `blip` из `desc_video.py` – он формирует описание на английском языке происходящего на видео. Описывается каждый 48 кадр из видео, а после все склеивается в одну строчку.  (документация [BLIP](https://www.figma.com/exit?url=https://github.com/salesforce/BLIP)).
3. Далее в этом же модуле `desc_video.py` переводится все описание с английского на русский с помощью `Helsinki-NLP/opus-mt-en-ru` ([документация модели](https://huggingface.co/Helsinki-NLP/opus-mt-en-ru)). И возвращается полученное описание.
4. Далее идет извлечение аудио из видео модулем `voice_desc.py`
	- Метод `is_russian_text` использует библиотеку langdetect для определения, является ли текст русским.
	- Метод `is_meaningful_text` проверяет осмысленность текста с помощью модели spaCy, анализируя предложения и слова в тексте.
	- Метод `check_text` объединяет предыдущие проверки и добавляет проверку на наличие длинных слов.
	- Метод `extract_speech` выполняет:
	    - Извлечение аудио из видеофайла с использованием библиотеки moviepy.
	    - Сохранение аудио в файл и его чтение с помощью библиотеки soundfile.
	    - Подготовку аудио данных для модели и их обработку для получения текста.
	    - Проверку полученного текста на осмысленность и его русскость с помощью метода `check_text`.
	    - Возвращает полученный текст, если он осмыслен, иначе возвращает пробел.

Можно напрямую подергать ручки этого сервиса. По ссылки можно посмотреть документацию http://zvezdolet.ddns.net: